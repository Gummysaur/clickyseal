<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>ClickySeal</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@v3.88.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">
let seal;
let icehole;
let score = 0;
let fpc = 1; // fish per click
let fps = 0; // idle fish gained per second
let i = 0; // index of fish pool
let numFish = 10; // # of fish in the pool
let fishPool = [];
let scoreBoard;
let fpsUpgradeLvl = 0; // level of FPS upgrade
let fpsUpgradeCost = 10; // how much it costs to upgrade FPS
let fpcUpgradeLvl = 0;
let fpcUpgradeCost = 5;
let timer = 0;
let fpsUpgrade; // sprite of the fps upgrade
let fpcUpgrade;
let toolTip;
let toolTipText;

var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);

function preload ()
{
    this.load.image('sky', 'assets/sky.png');
    this.load.image('icehole', 'assets/icehole.png');
    this.load.image('seal', 'assets/seal.png');
    this.load.image('fish', 'assets/fish.png');
}

function create ()
{
    this.add.image(400, 300, 'sky');
    scoreBoard = this.add.text(20, 30, 'Fish: ' + score, {
        fontFamily: 'serif', 
        fontSize: '24px'
    });
    icehole = this.add.image(300, 100, 'icehole').setInteractive();
    seal = this.add.image(400, 300, 'seal').setScale(0.25);

    fpsUpgrade = this.add.rectangle(300, 500, 100, 100, 0xffffff).setInteractive();
    fpcUpgrade = this.add.rectangle(500, 500, 100, 100, 0x00ff00).setInteractive();
    toolTip =  this.add.rectangle(900, 700, 300, 100, 0xffffff).setOrigin(0);
    toolTipText = this.add.text(900, 700, 
        '  Fisherman:\nIncreases idle fish gained per second. \n Costs ' + fpsUpgradeCost + ' fish.', 
        { fontFamily: 'Arial', color: '#000' }).setOrigin(0);

    this.input.setPollOnMove();

    /*
    this.input.on('gameobjectover', function (pointer, gameObject) {
        this.tweens.add({
          targets: [toolTip, toolTipText],
          alpha: {from:0, to:1},
          repeat: 0,
          duration: 500
      });
    }, this);
    */

    this.input.on('gameobjectout', function (pointer, gameObject) {
        toolTip.setPosition(900, 700);
        toolTipText.setPosition(900, 700);
    });
    
    fpsUpgrade.on('pointermove', function (pointer, x, y, event) {
        toolTipText.setText('  Fisherman:\nIncreases idle fish gained per second. \n Costs ' + fpsUpgradeCost + ' fish.');
        toolTip.x = pointer.x;
        toolTip.y = pointer.y;
        toolTipText.x = pointer.x + 5;
        toolTipText.y = pointer.y + 5;
    });

    fpcUpgrade.on('pointermove', function (pointer, x, y, event) {
        toolTipText.setText('  Bait:\nIncreases fish gained per click. \n Costs ' + fpcUpgradeCost + ' fish.');
        toolTip.x = pointer.x;
        toolTip.y = pointer.y;
        toolTipText.x = pointer.x + 5;
        toolTipText.y = pointer.y + 5;
    });

    fpsUpgrade.on('pointerdown', () => {
        if(score >= fpsUpgradeCost){
            score -= fpsUpgradeCost;
            fpsUpgradeLvl++;
            fps = fpsUpgradeLvl * 5;
            fpsUpgradeCost+=10;
        }
    });

    fpcUpgrade.on('pointerdown', () => {
        if(score >= fpcUpgradeCost){
            score -= fpcUpgradeCost;
            fpcUpgradeLvl++;
            fpc = fpcUpgradeLvl * 3;
            fpcUpgradeCost+=10;
        }
    });

    for (let d = 0; d < numFish; d++) {
        let fish = this.add.image(850, 650, 'fish');
        fishPool.push(fish);
    }

    // give fish when you click the ice hole
    icehole.on('pointerdown', () => {
        score+=fpc;
        if(i == numFish){
            i = 0;
        }
        let thisFish = fishPool[i];
        i++;
        thisFish.setPosition(300, 100);
        this.tweens.add({
            targets: thisFish,
            x: 300 + (Math.random() * 30) * (Math.random() < 0.5 ? -1 : 1),
            y: 80 - (Math.random() * 50),
            ease: 'Cubic',
            alpha: 0,
            duration: 700,
            repeat: 0,
            yoyo: false,
            onComplete: function(){
                thisFish.setPosition(850, 650);
                thisFish.alpha = 1;
            }
        });
    });



}

function update (time, delta)
{
    timer += delta;
    while (timer > 1000) {
        score += fps;
        timer -= 1000;
    }

    scoreBoard.setText('Fish: ' + score);
}




</script>

</body>
</html>